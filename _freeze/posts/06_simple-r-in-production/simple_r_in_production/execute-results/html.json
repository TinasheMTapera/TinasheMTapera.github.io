{
  "hash": "e3ee1d7f2df628b0f9babe04f5792ded",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"A Simple Demonstration of R in Production\"\nauthor: \"Tinashe M. Tapera\"\ndate: \"2025-02-23\"\nimage: https://d1jnx9ba8s6j9r.cloudfront.net/blog/wp-content/uploads/2017/06/R-Programming_02.png\n---\n\n\n\n![](https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExeG1kemZ3eW9rMnI4ZjB3eG9ud2lobXJ3YjlxaDVjM3BmbGhkMWxudiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/UPqYp2tj61XlBhlPbH/giphy.gif)\n\nLast summer, I found a part-time job that had no fixed\nschedule; instead, a schedule was sent week-to-week,\nmeaning that I had to check the app we used for HR pretty\nmuch two or three times a week to know ahead of time when I would\nbe working. This ended up being a huge pain, as adding the shifts\nby hand was tedious and, of course, error prone. So, naturally,\nI did what anyone with some programming chops would do: try to automate it.\n\nNow, for most people in this scenario, they might lean directly on\na traditional \"app development\" option like building a standalone iOS app,\nbut I wanted to try out something different. Recently, the \n[Data Science Learning Community (DSLC.io)](https://dslc.io) finished our first cohort reading the\nbook [DevOps for Data Science](https://do4ds.com) in which author Alex Gold\nfrom Posit gives data scientists a gentle introduction to the world of DevOps.\nIn the book's introduction, Gold writes:\n\n> Data science alone is pretty useless... What does matter is\n[that your work] affects decisions at your organization or in the broader world.\n\nIn other words, making a fancy model or having the prettiest graph\nisn't quite the end-goal of data science. Instead, whatever data crunching you do should provide some value\nto someone in some actionable way. Gold considers this to be \"in production.\"\n\n> For some organizations, in production means a report that gets rendered and emailed around. For others, it means hosting a live app or dashboard that people visit. For the most sophisticated, it means serving live predictions to another service from a machine learning model via an application programming interface (API).\nRegardless of the maturity or the form, every organization wants to know that the work is reliable, the environment is safe, and that the product will be available when people need it.\n\nThis struck me as incredibly poignant advice, because for many years I'd been\nwrestling with the argument, both internally and online with others,\nthat [R cannot be used in production](https://mkaye.dev/blog/lessons-learned-from-running-r-in-production). Of course, this is complete hogwash,\nbut it can be hard to argue authoritatively when I myself had rarely had\nsignificant use cases to the contrary. Thus, I set out, in this simple project,\nto demonstrate that R is absolutely viable in production, even for a small\ntask like automating my shift scheduling[^1].\n\n## Using R in Production: Why It’s More Than Just a Research Tool\n\nWhen it comes to production environments, Python often gets all the attention in data science. \nBut why not R? Can it really hold its own in the world of production?\nThe answer is a tentative *yes, with the right tools and infrastructure.* \nR can be just as capable as Python for many production scenarios; it just takes\na little bit of forethought, which, let's be honest, you were going\nto have to do in any language anyway.\n\n### The Benefits of R in Production\n\nR is renowned for its statistical and data analysis capabilities. It’s the go-to\nlanguage for data scientists and researchers, and for good reason. \nWith packages like the `tidyverse`, `tidymodels`, and `data.table`, \nR makes data manipulation and visualization a breeze. But these strengths \naren’t limited to research; they’re just as valuable in production environments where data\nneeds to be churned into value.\n\nAnother advantage of R is its speed of development. Frameworks like Shiny\nallow for rapid prototyping and deployment of interactive applications. \nThis agility is a significant asset in production environments where quick\niteration is often necessary, and combined with Posit's commercial product offering\nof production environment tools, a data science ecosystem is just a few clicks away[^2].\n\n### Overcoming R’s Limitations\n\nOf course, R isn’t without its limitations. Its single-threaded \nout-of-the-box nature can limit concurrency, which is a challenge in high-traffic\nenvironments. However, tools like `httpuv` and the recently released [`valve`](https://valve.josiahparry.com)\ncan help mitigate this by handling multiple requests concurrently.\nPerformance is another area where R *might* lag behind compiled languages. But for many tasks, R’s\nperformance is comparable to Python’s, especially when using optimized packages like `data.table`.\nBesides, there's ample evidence to suggest that [the argument that R is specifically too\nslow for production is bogus](https://josiahparry.com/posts/2023-07-06-r-is-still-fast)[^3].\nLastly, R’s package ecosystem is vast but can be a tad complex. Tools like `renv` help manage package\ndependencies, ensuring that your application uses consistent versions of packages across different environments.\n\n### The Power of Infrastructure\nSo, how do we overcome these limitations and make R production-ready? The key is leveraging the right infrastructure:\n- Containerization with Docker: Docker simplifies deployment by encapsulating your application and its dependencies, ensuring consistent environments across different machines.\n- Cloud Services: Platforms like AWS or Google Cloud provide scalable infrastructure that can handle high traffic and concurrency issues.\n- API Frameworks: Tools like Plumber enable R to be used as a backend for web applications, integrating seamlessly with other technologies.\n\n## A Real-World Example: Calendar Event Generator\n\nLet’s walk through the development of a simple application that demonstrates R’s potential in production: \nan API that generates calendar events from screenshots of my schedule.\n\n### Step 1: Plumber API Development\n\n![Plumber to the rescue!](https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExa3BiNWdtZGRkNHJ6OGJwajF3Z2gxb29sc2EzaXAxaWpsZnMxajV4ayZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/HOsHtiVdeypFxOhLAf/giphy.gif)\n\nFirst, we need to create API endpoints using Plumber. For this application, \nwe’ll define an endpoint that accepts a screenshot and returns an .ics file.\nSince the screenshot was always a standard shape and text, I used the simple\n`tesseract` library to use OCR to extract text from the image (I'm sure\nthat nowadays, a fancy AI solution might do it even better, but I was\ngoing for simplicity here). You can simply create a function like this:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#' extract_text\n#' \n#' @description\n#' Extract text from a screenshot image\n#'\n#' @param img_file Screenshot of the schedule for the week\n#' @importFrom tesseract tesseract ocr\n#' @return Text extracted from the screenshot\n#' @export\nextract_text <- function(img_file) {\n  \n  eng <- tesseract(\"eng\")\n  text <- ocr(img_file, engine = eng)\n\n  text\n}\n```\n:::\n\n\n\nThis function can then be wrapped in some processing function,\nwhich we use as the endpoint for the API in `plumber`. I have\nincluded pseudocode here to represent the processing steps, which included\nstring manipulation (`stringr`), datetime manipulation (`lubridate`),\nand dynamic string variable generation (`glue`).\nIt's also worth mentioning that you can convert a dataframe\ninto an iCal file with the `calendar` library:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#* Convert the input image to an ical event\n#* @param img_file:file the screenshot\n#* @param event_title:string title of the event\n#* @post /schedule\n#* @serializer text\nfunction(img_file, event_title = \"Reservoir (autogenerated)\") {\n  \n  # Process the screenshot to extract event details\n  text <- extract_text(img_file)\n\n  ic <- process_text_into_dataframe(text) %>%\n    convert_data_frame_to_ic_file()\n\n  # Generate an .ics file and return it as an attachment\n  as_attachment(ic, \"output.ics\")\n}\n```\n:::\n\n\n\nNote that we've used `renv` to manage package dependencies for,\nthese libraries, ensuring that our application uses consistent\nversions of packages across environments. The dependencies are\nrecorded in the `renv.lock` file.\n\n### Step 2: Dockerization\n\n![It's time to Dockerize](/assets/img/oie_2ekNy9GFgopy.jpg)\n\nNext, we’ll create a Dockerfile that installs necessary dependencies, copies the application code, and sets up the environment for running the Plumber API.\n\n\n\n::: {.cell}\n\n```{.dockerfile .cell-code}\nFROM rocker/r-ver\n\n# Install renv and other dependencies\nRUN R -e \"install.packages('renv', repos = c(CRAN = 'https://cloud.r-project.org'))\"\n\n# Copy renv.lock and activate renv\nWORKDIR /project\nCOPY renv.lock renv.lock\nENV RENV_PATHS_LIBRARY renv/library\n\n# Install system dependencies\nRUN apt-get update && apt-get install -y libxml2-dev libssl-dev\n\n# Copy application code\nCOPY . .\n\n# Restore renv environment\nRUN R -e \"renv::restore()\"\n\n# Expose port for API\nEXPOSE 8080\n\n# Run Plumber API\nENTRYPOINT [\"R\", \"-e\", \"pr <- plumber::plumb('plumber.R'); pr$run(host='0.0.0.0', port=as.numeric(Sys.getenv('PORT')))\", \"8080\"]\n```\n:::\n\n\n\n### Step 3: Deployment\n\n![Are you ready....?](https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExb2ljbnB6Zng5YzJqN2d3ZHpoOGRpZDNnYjgyZTdvamRoeTlvMmxmYSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/PApUm1HPVYlDNLoMmr/giphy.gif)\n\nNext, we build the Docker image and deploy it to a cloud platform — I chose Google Cloud — which allows for easy scaling and management of the application. Specifically, I followed [this humorous tutorial](https://youtu.be/cw34KMPSt4k?si=_uO5T2gdpXftUK4t)\non how to deploy any Docker container to the cloud.\n\n### Step 4: Accessing\n\nThe last step was to create a very simple iOS shortcut \"app\". The basic process is to capture\na screenshot to the clipboard, and then send the clipboard content to the plumber endpoint listening\non Google cloud. Once the plumber endpoint receives the screenshot, it processes it using\nour R code, produces the iCal file, and sends it back to the phone, which opens it up in Calendar.\n\n![iOS Shortcut as an App](/assets/img/Screenshot 2025-02-23 at 23.43.57.png)\n\n### Conclusion\n\nAnd just like that, Bob's your uncle. A fully functioning application that runs on my phone,\nusing the internet, providing every day value to me, and that is completely powered by R.\nYou can see the repo with the actual code for this app [here](https://github.com/TinasheMTapera/ScreenShot2CalendarEndpoint).\nAs you can see, with a little bit of elbow grease, R can be more than just a research tool; \nit’s a capable language for production environments.\nBy leveraging the right infrastructure and tools, R applications can be robust, \nreliable, and efficient. Whether you’re working with data analysis, machine learning, \nor web applications, R has the potential to shine in production. So, the next time you’re \nconsidering \"productionizing\" a project, don’t overlook R. With its strengths in statistical\nanalysis and data visualization, combined with modern tools and infrastructure,\nR can bridge the gap between research and production, offering a cost-effective and \nefficient solution for data-driven applications.\n\n![Happy coding!](https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExdW8xY3hrMGcwMXNibHQ5bHFyMHZheWEyeTd0Z2ViMnFrdzUwbTRwcCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/wcgn5fVDjvR7pdvz4C/giphy.gif)\n\n[^1]: For the record, DO4DS is not a language opinionated book — it features labs\nin both R and Python, and I encourage anyone who has ever been \"mystified\" by this\nidea of data science in production to give it a thorough read.\n\n[^2]: It's worth noting that Hadley Wickham, head of Posit and veritable godhead of\nthe R pantheon, is himself working on [a book about R in production](https://r-in-production.org); so watch this space...\n\n[^3]: Josiah Parry's thoughts in this space are interesting; I highly encourage reading the\nback-and-forth arguments about R's speed to learn specifically _why_ the argument about\nspeed in production is actually misaligned to whether or not R is appropriate.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}